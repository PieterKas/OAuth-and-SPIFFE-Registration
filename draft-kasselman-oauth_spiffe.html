<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OAuth Client Registration on First Use with SPIFFE</title>
<meta content="Pieter Kasselman" name="author">
<meta content='
       The OAuth framework is a widely deployed authorization protocol standard that enables applications to obtain limited access to user resources. OAuth clients must be registered with the OAuth authorization server, which poses significant operational challenges in dynamically scaling environments. The Secure Production Identity Framework For Everyone (SPIFFE) is a graduated Cloud Native Compute Foundation project designed to dynamically attest and verify workload identity. This draft describes how workloads with SPIFFE credentials can be used with OAuth to lessen the operational burden of client registration through a "register on first use" principle. 
    ' name="description">
<meta content="xml2rfc 3.28.1" name="generator">
<meta content="workload" name="keyword">
<meta content="identity" name="keyword">
<meta content="credential" name="keyword">
<meta content="client" name="keyword">
<meta content="registration" name="keyword">
<meta content="draft-kasselman-oauth_spiffe-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.28.1
    Python 3.12.10
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.0
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-kasselman-oauth_spiffe.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OAuth Client Registration on First Use w</td>
<td class="right">May 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Kasselman</td>
<td class="center">Expires 2 December 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Web Authorization Protocol</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-kasselman-oauth_spiffe-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-05-31" class="published">31 May 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-12-02">2 December 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">P. Kasselman</div>
<div class="org">SPIRL</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OAuth Client Registration on First Use with SPIFFE</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The OAuth framework is a widely deployed authorization protocol standard that enables applications to obtain limited access to user resources. OAuth clients must be registered with the OAuth authorization server, which poses significant operational challenges in dynamically scaling environments. The Secure Production Identity Framework For Everyone (SPIFFE) is a graduated Cloud Native Compute Foundation project designed to dynamically attest and verify workload identity. This draft describes how workloads with SPIFFE credentials can be used with OAuth to lessen the operational burden of client registration through a "register on first use" principle.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://PieterKas.github.io/OAuth-and-SPIFFE/draft-kasselman-oauth_spiffe.html">https://PieterKas.github.io/OAuth-and-SPIFFE/draft-kasselman-oauth_spiffe.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-kasselman-oauth_spiffe/">https://datatracker.ietf.org/doc/draft-kasselman-oauth_spiffe/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Web Authorization Protocol Working Group mailing list (<span><a href="mailto:oauth@ietf.org">mailto:oauth@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/oauth/">https://mailarchive.ietf.org/arch/browse/oauth/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/oauth/">https://www.ietf.org/mailman/listinfo/oauth/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/PieterKas/OAuth-and-SPIFFE">https://github.com/PieterKas/OAuth-and-SPIFFE</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 2 December 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-client-registration-on-firs" class="internal xref">Client Registration On First Use</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-client-registration-on-first" class="internal xref">Client Registration On First Use for Non-Redirecting OAuth Flows</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-client-registration-on-first-u" class="internal xref">Client Registration On First Use for Redirecting OAuth Flows</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-spiffe-and-oauth-trust-rela" class="internal xref">SPIFFE and OAuth Trust Relationship</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-client-authentication" class="internal xref">Client Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-authorization-server-proces" class="internal xref">Authorization Server Processing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-non-redirect-flows" class="internal xref">Non-redirect flows</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-redirect-flows" class="internal xref">Redirect flows</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-additional-metadata" class="internal xref">Additional metadata</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-the-redirect-uri" class="internal xref">The redirect URI</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-scopes" class="internal xref">Scopes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-grant-types" class="internal xref">Grant Types</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-client-id-lifecycle-managem" class="internal xref">Client ID Lifecycle Management</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The OAuth framework <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span> is popular and broadly deployed. It defines separate roles for the authorization server, resource server, resource owner and the client. In OAuth, the client requests access to resources controlled by the resource owner and hosted by the resource server, and is issued a different set of credentials than those of the resource owner <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>. The OAuth client is identified with a <code>client_id</code> and supports multiple authentication methods, such as the commonly-used <code>client_secret</code>. The management of <code>client_id</code>s and <code>client_secret</code>s represents operational challenges, including manual registrations, lifecycle management and the increasing burden of managing <code>client_secret</code>s used for authenticating OAuth clients. Modern cloud-native architectural patterns, like micro-services and other ephemeral compute concepts, allows for on-demand scaling of OAuth clients, which in turn increases the burden on managing the lifecycle of the <code>client_id</code> and <code>client_secret</code>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The Secure Production Identity Production Framework (SPIFFE) is a graduated project in the Cloud Native Compute Foundation (CNCF) that defines a standard for managing the identity lifecycle of workloads in modern cloud-native compute environments. It is designed to dynamically attest and verify a workloads, assign identifiers, issue credentials and manage the lifecycle of those credentials in dynamically scaled environments without manual intervention. The identifier is an URI, while the credentials include profiles of JWT and X.509 certificates, known as JWT-SVID and X.509-SVIDs. These credentials are used by workloads to authenticate to each other or to services that they need to access. SPIFFE is commonly used to secure workload identities in large-scale production systems that need to scale dynamically.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Workloads provisioned with SPIFFE identifiers and credentials often need to access OAuth-protected resources. When they interact with OAuth-protected resources, they assume the role of an OAuth client and need to be registered with the OAuth authorization server. This requries an additional manual step, or an additional registration flow (e.g. Dynamic Client Registration <span>[<a href="#RFC7591" class="cite xref">RFC7591</a>]</span> ). The registration step results in the provisioning of an addditional identifier (the <code>client_id</code>), and frequently an additional secret (the <code>client_secret</code>) used for client authentication and must be secured. The additional secrets add to the overall challenge of secrets sprawl in large-scale environments, and degrade the risk profile for an environment.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">OAuth deployments in which SPIFFE is already deployed can leverage the SPIFFE identifiers and credentials already issued to workloads by establishing a trust relationship with the SPIFFE issuer. When a workload acts as an OAuth client, it presents a SPIFFE credential to authenticate itself to the OAuth server. The OAuth authorization server verifies the JWT or X.509 certificate, ensuring it was issued by a trusted issuer. The authorization server registers the SPIFFE ID as a client ID, along with additional metadata, if needed, before issuing an Access Token.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This "register on first use" pattern removes the need for manual pre-registration or additional roundtrips and credential registration. It leverages existing credentials that were issued dynamically and reduces the dependence on static secrets which are at higher risk of compromise than ephemeral dynamic credentials.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-registration-on-first-use">
<section id="section-3">
      <h2 id="name-client-registration-on-firs">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-client-registration-on-firs" class="section-name selfRef">Client Registration On First Use</a>
      </h2>
<p id="section-3-1">The SPIFFE deployment is responsible for bootstrapping the identifiers and credentials used by workloads in an environment. The SPIFFE deployment dynamically attests workloads, issues identifiers, provisions ephemeral credentials, and rotates those credentials. The attestation techniques used by a SPIFFE issuer is deployment-specific. SPIFFE supports multiple credential formats, including JWT-SVID <span>[<a href="#SPIFFE_JWT" class="cite xref">SPIFFE_JWT</a>]</span> and JWT-X.509 <span>[<a href="#SPIFFE_X509" class="cite xref">SPIFFE_X509</a>]</span>. Workloads can use these credentials with any protocol that is compatible with these credential types to authenticate themselves. The use of SPIFFE credentials to authenticate to an OAuth authorization server is described in <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">An OAuth deployment leverages the SPIFFE identifiers and credentials already issued to workloads by establishing a trust relationship with the SPIFFE issuer. As a result, the OAuth authorization server is able to verify any credential issued for a specific SPIFFE trust domain when it is presented to the OAuth authorization server. This assures the OAuth authorization server that the workload was attested and verified in acccordance with the SPIFFE issuer's policies. In addition, it is assured that the identifier was correctly assigned to the workload, and that the lifecycle of the credentials and the underlying keys are managed in accordance with the SPIFFE issuer's policies.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">The OAuth authorization server avoids operational overheads of registering <code>client_id</code> and <code>client_secret</code> values by accepting SPIFFE credentials from a workload acting as an OAuth client participating in an OAuth flow. The credentials must be signed by a trusted issuer. If this is the first time the authorization server verifies a credential wth a specific SPIFFE ID, it registers a new <code>client_id</code>, removing the need for an out-of-band registration flow. The OAuth authorization server may derive a unique <code>client_id</code> from the SPIFFE ID, or it may use the SPIFFE ID as the <code>client_id</code>. Since the workload is already in possession of a credential that is cryptographically bound to its identifier, no addditional <code>client_secret</code> is needed, removing the operational overhead and securtiy risks of managing long-lived secrets in large-scale deployments that already have SPIFFE credentials. The OAuth authorization server may register additional metadata if needed. How the additional metadata is obtained is a deployment-specific implementation choice. Metadata may be preconfigured, automatically created or retrieved from a configuration management system.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">The "register on first use" implementation varies depending whether or not the OAuth flows includes redirection. In non-redirecting flows (such as Client Credentials or Resource Owner Password Credentials), the OAuth client authenticates and requests tokens directly from the authorization server without the need for user redirection. Flows with redirection (like Authorization Code Flow) temporarily send users to an external identity provider before returning them to the application with a token or authorization code, which is then used by the OAuth client. These redirect-based flows rely on the user agent (typically a web browser) to maintain the authentication context and handle the navigation between the application and the identity provider. These fundamental differences require distinct implementation considerations when implementing client registration on first use. Redirecting flows need state management to reconnect returning users with their original session after authentication, while non-redirecting flows can create a <code>client_id</code> inline within the same request context. Properly handling both OAuth patterns ensures a smooth registration experience regardless of the authentication method selected.<a href="#section-3-4" class="pilcrow">¶</a></p>
<div id="client-registration-on-first-use-for-non-redirecting-oauth-flows">
<section id="section-3.1">
        <h3 id="name-client-registration-on-first">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-client-registration-on-first" class="section-name selfRef">Client Registration On First Use for Non-Redirecting OAuth Flows</a>
        </h3>
<p id="section-3.1-1">In OAuth flows where there is no redirection, the client initiates interaction with the authorization server and accesses the token endpoint directly without any preceding redirects. Examples include the Client Credentials (see Section 4.4 of <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>) and Resource Owner Password Credentials (see Section 4.3 of <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>).<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">The diagram below shows the process for "register on first use" in the Client Credential flow.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<span id="name-client-registration-on-first-"></span><figure id="figure-1">
          <div id="section-3.1-3.1">
            <div class="alignLeft art-svg artwork" id="section-3.1-3.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="368" width="456" viewBox="0 0 456 368" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,80" fill="none" stroke="black"></path>
                <path d="M 8,160 L 8,240" fill="none" stroke="black"></path>
                <path d="M 64,88 L 64,152" fill="none" stroke="black"></path>
                <path d="M 64,240 L 64,320" fill="none" stroke="black"></path>
                <path d="M 120,32 L 120,80" fill="none" stroke="black"></path>
                <path d="M 120,160 L 120,240" fill="none" stroke="black"></path>
                <path d="M 336,160 L 336,240" fill="none" stroke="black"></path>
                <path d="M 336,288 L 336,352" fill="none" stroke="black"></path>
                <path d="M 384,64 L 384,152" fill="none" stroke="black"></path>
                <path d="M 448,160 L 448,240" fill="none" stroke="black"></path>
                <path d="M 448,288 L 448,352" fill="none" stroke="black"></path>
                <path d="M 8,32 L 120,32" fill="none" stroke="black"></path>
                <path d="M 128,64 L 384,64" fill="none" stroke="black"></path>
                <path d="M 8,80 L 120,80" fill="none" stroke="black"></path>
                <path d="M 8,160 L 120,160" fill="none" stroke="black"></path>
                <path d="M 336,160 L 448,160" fill="none" stroke="black"></path>
                <path d="M 120,176 L 328,176" fill="none" stroke="black"></path>
                <path d="M 128,224 L 336,224" fill="none" stroke="black"></path>
                <path d="M 8,240 L 120,240" fill="none" stroke="black"></path>
                <path d="M 336,240 L 448,240" fill="none" stroke="black"></path>
                <path d="M 336,288 L 448,288" fill="none" stroke="black"></path>
                <path d="M 64,320 L 328,320" fill="none" stroke="black"></path>
                <path d="M 336,352 L 448,352" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="392,152 380,146.4 380,157.6" fill="black" transform="rotate(90,384,152)"></polygon>
                <polygon class="arrowhead" points="336,320 324,314.4 324,325.6" fill="black" transform="rotate(0,328,320)"></polygon>
                <polygon class="arrowhead" points="336,176 324,170.4 324,181.6" fill="black" transform="rotate(0,328,176)"></polygon>
                <polygon class="arrowhead" points="136,224 124,218.4 124,229.6" fill="black" transform="rotate(180,128,224)"></polygon>
                <polygon class="arrowhead" points="136,64 124,58.4 124,69.6" fill="black" transform="rotate(180,128,64)"></polygon>
                <polygon class="arrowhead" points="72,152 60,146.4 60,157.6" fill="black" transform="rotate(90,64,152)"></polygon>
                <polygon class="arrowhead" points="72,88 60,82.4 60,93.6" fill="black" transform="rotate(270,64,88)"></polygon>
                <g class="text">
                  <text x="144" y="36">(A)</text>
                  <text x="216" y="36">Authorization</text>
                  <text x="300" y="36">Server</text>
                  <text x="376" y="36">Establishes</text>
                  <text x="60" y="52">SPIFFE</text>
                  <text x="184" y="52">Trust</text>
                  <text x="228" y="52">with</text>
                  <text x="276" y="52">SPIFFE</text>
                  <text x="332" y="52">Issuer</text>
                  <text x="60" y="68">Issuer</text>
                  <text x="88" y="116">(B)</text>
                  <text x="132" y="116">SPIFFE</text>
                  <text x="188" y="116">Issuer</text>
                  <text x="248" y="116">Attests</text>
                  <text x="316" y="116">Workload</text>
                  <text x="120" y="132">and</text>
                  <text x="180" y="132">Provisions</text>
                  <text x="272" y="132">Credentials</text>
                  <text x="60" y="180">Workload</text>
                  <text x="52" y="196">acting</text>
                  <text x="92" y="196">as</text>
                  <text x="144" y="196">(C)</text>
                  <text x="216" y="196">Authorization</text>
                  <text x="392" y="196">Authorization</text>
                  <text x="56" y="212">OAuth</text>
                  <text x="192" y="212">Request</text>
                  <text x="388" y="212">Server</text>
                  <text x="60" y="228">Client</text>
                  <text x="144" y="244">(D)</text>
                  <text x="216" y="244">Authorization</text>
                  <text x="196" y="260">Response</text>
                  <text x="388" y="308">Resource</text>
                  <text x="388" y="324">Server</text>
                  <text x="80" y="340">(E)</text>
                  <text x="124" y="340">Access</text>
                  <text x="188" y="340">Resource</text>
                </g>
              </svg><a href="#section-3.1-3.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-client-registration-on-first-" class="selfRef">Client Registration on First Use: Client Credentials Grant</a>
          </figcaption></figure>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <p id="section-3.1-4.1.1">(A) The OAuth authorization server establishes a trust relationship with the SPIFFE Issuer. Once trust is established, the OAuth authorization server accepts credentials issued by the SPIFFE Issuer.<a href="#section-3.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1">(B) The workload is attested and credentialed by the SPIFFE Issuer <span>[<a href="#SPIFFE" class="cite xref">SPIFFE</a>]</span>. The SPIFFE Issuer assigns a SPIFFE ID <span>[<a href="#SPIFFE_ID" class="cite xref">SPIFFE_ID</a>]</span> as an identifier for the workload, along with SPIFFE credentials (e.g. JWT-SVID <span>[<a href="#SPIFFE_JWT" class="cite xref">SPIFFE_JWT</a>]</span> and X.509-SVID <span>[<a href="#SPIFFE_X509" class="cite xref">SPIFFE_X509</a>]</span>).<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.3">
            <p id="section-3.1-4.3.1">(C) The workload, acting as an OAuth client, makes a request to the authorization server's token endpoint as specified in Section 4.4 of <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>. It authenticates itself using either a JWT-SVID or X.509-SVID as defined in <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span><a href="#section-3.1-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.4">
            <p id="section-3.1-4.4.1">(D) The OAuth authorization server authenticates the workload acting as an OAuth client by verifying the credentials it presented (see <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span>). If the authentication is successful, the authorization server accepts the SPIFFE ID as a valid client ID and checks if it has been registered previously. If it has not been registered, it registers the new SPIFFE ID as a valid client. The authorization server adds additional metadata if needed, before completing the request and returning an access token.<a href="#section-3.1-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.1-4.5">
            <p id="section-3.1-4.5.1">(E) The Oauth client use the access token it retrieved in the previous step and use it to acccess the resource server.<a href="#section-3.1-4.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="client-registration-on-first-use-for-redirecting-oauth-flows">
<section id="section-3.2">
        <h3 id="name-client-registration-on-first-u">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-client-registration-on-first-u" class="section-name selfRef">Client Registration On First Use for Redirecting OAuth Flows</a>
        </h3>
<p id="section-3.2-1">In OAuth flows that rely on redirection, the initial interaction with the authorization server is not performed by the client, but is instead performed by another component, such as the user agent. These flows typically include interaction with the Resource Owner in order to perform user authentication and grant authorization. Once the Resource Owner authenticated and granted authorization, the flow is redirected back to the client. The client then interacts with the authorization server token endpoint to complete the flow and obtain tokens. Examples include the Authorization Grant Flow (see Section 4.1 of <span>[<a href="#RFC6749" class="cite xref">RFC6749</a>]</span>).<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<span id="name-client-registration-on-first-us"></span><figure id="figure-2">
          <div id="section-3.2-2.1">
            <div class="alignLeft art-svg artwork" id="section-3.2-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="576" width="544" viewBox="0 0 544 576" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 16,64 L 16,96" fill="none" stroke="black"></path>
                <path d="M 16,128 L 16,512" fill="none" stroke="black"></path>
                <path d="M 48,32 L 48,80" fill="none" stroke="black"></path>
                <path d="M 48,160 L 48,224" fill="none" stroke="black"></path>
                <path d="M 48,288 L 48,384" fill="none" stroke="black"></path>
                <path d="M 48,464 L 48,544" fill="none" stroke="black"></path>
                <path d="M 64,392 L 64,416" fill="none" stroke="black"></path>
                <path d="M 88,232 L 88,256" fill="none" stroke="black"></path>
                <path d="M 104,384 L 104,400" fill="none" stroke="black"></path>
                <path d="M 104,432 L 104,456" fill="none" stroke="black"></path>
                <path d="M 128,464 L 128,544" fill="none" stroke="black"></path>
                <path d="M 136,160 L 136,224" fill="none" stroke="black"></path>
                <path d="M 136,288 L 136,384" fill="none" stroke="black"></path>
                <path d="M 160,32 L 160,80" fill="none" stroke="black"></path>
                <path d="M 408,288 L 408,384" fill="none" stroke="black"></path>
                <path d="M 440,384 L 440,480" fill="none" stroke="black"></path>
                <path d="M 472,64 L 472,280" fill="none" stroke="black"></path>
                <path d="M 472,392 L 472,528" fill="none" stroke="black"></path>
                <path d="M 536,288 L 536,384" fill="none" stroke="black"></path>
                <path d="M 48,32 L 160,32" fill="none" stroke="black"></path>
                <path d="M 16,64 L 40,64" fill="none" stroke="black"></path>
                <path d="M 168,64 L 472,64" fill="none" stroke="black"></path>
                <path d="M 48,80 L 160,80" fill="none" stroke="black"></path>
                <path d="M 48,160 L 136,160" fill="none" stroke="black"></path>
                <path d="M 48,224 L 136,224" fill="none" stroke="black"></path>
                <path d="M 48,288 L 136,288" fill="none" stroke="black"></path>
                <path d="M 408,288 L 536,288" fill="none" stroke="black"></path>
                <path d="M 136,304 L 176,304" fill="none" stroke="black"></path>
                <path d="M 192,304 L 208,304" fill="none" stroke="black"></path>
                <path d="M 368,304 L 400,304" fill="none" stroke="black"></path>
                <path d="M 136,336 L 176,336" fill="none" stroke="black"></path>
                <path d="M 192,336 L 208,336" fill="none" stroke="black"></path>
                <path d="M 376,336 L 400,336" fill="none" stroke="black"></path>
                <path d="M 144,368 L 184,368" fill="none" stroke="black"></path>
                <path d="M 200,368 L 216,368" fill="none" stroke="black"></path>
                <path d="M 384,368 L 408,368" fill="none" stroke="black"></path>
                <path d="M 48,384 L 136,384" fill="none" stroke="black"></path>
                <path d="M 408,384 L 536,384" fill="none" stroke="black"></path>
                <path d="M 48,464 L 128,464" fill="none" stroke="black"></path>
                <path d="M 136,480 L 168,480" fill="none" stroke="black"></path>
                <path d="M 184,480 L 200,480" fill="none" stroke="black"></path>
                <path d="M 368,480 L 440,480" fill="none" stroke="black"></path>
                <path d="M 16,512 L 40,512" fill="none" stroke="black"></path>
                <path d="M 136,528 L 168,528" fill="none" stroke="black"></path>
                <path d="M 184,528 L 224,528" fill="none" stroke="black"></path>
                <path d="M 344,528 L 472,528" fill="none" stroke="black"></path>
                <path d="M 48,544 L 128,544" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="480,392 468,386.4 468,397.6" fill="black" transform="rotate(270,472,392)"></polygon>
                <polygon class="arrowhead" points="480,280 468,274.4 468,285.6" fill="black" transform="rotate(90,472,280)"></polygon>
                <polygon class="arrowhead" points="408,336 396,330.4 396,341.6" fill="black" transform="rotate(0,400,336)"></polygon>
                <polygon class="arrowhead" points="408,304 396,298.4 396,309.6" fill="black" transform="rotate(0,400,304)"></polygon>
                <polygon class="arrowhead" points="176,64 164,58.4 164,69.6" fill="black" transform="rotate(180,168,64)"></polygon>
                <polygon class="arrowhead" points="152,368 140,362.4 140,373.6" fill="black" transform="rotate(180,144,368)"></polygon>
                <polygon class="arrowhead" points="144,528 132,522.4 132,533.6" fill="black" transform="rotate(180,136,528)"></polygon>
                <polygon class="arrowhead" points="144,480 132,474.4 132,485.6" fill="black" transform="rotate(180,136,480)"></polygon>
                <polygon class="arrowhead" points="112,456 100,450.4 100,461.6" fill="black" transform="rotate(90,104,456)"></polygon>
                <polygon class="arrowhead" points="96,232 84,226.4 84,237.6" fill="black" transform="rotate(270,88,232)"></polygon>
                <polygon class="arrowhead" points="72,392 60,386.4 60,397.6" fill="black" transform="rotate(270,64,392)"></polygon>
                <polygon class="arrowhead" points="48,512 36,506.4 36,517.6" fill="black" transform="rotate(0,40,512)"></polygon>
                <polygon class="arrowhead" points="48,64 36,58.4 36,69.6" fill="black" transform="rotate(0,40,64)"></polygon>
                <g class="text">
                  <text x="184" y="36">(A)</text>
                  <text x="256" y="36">Authorization</text>
                  <text x="340" y="36">Server</text>
                  <text x="416" y="36">Establishes</text>
                  <text x="100" y="52">SPIFFE</text>
                  <text x="224" y="52">Trust</text>
                  <text x="268" y="52">with</text>
                  <text x="316" y="52">SPIFFE</text>
                  <text x="372" y="52">Issuer</text>
                  <text x="100" y="68">Issuer</text>
                  <text x="16" y="116">(B)</text>
                  <text x="60" y="116">SPIFFE</text>
                  <text x="116" y="116">Issuer</text>
                  <text x="176" y="116">Attests</text>
                  <text x="244" y="116">Workload</text>
                  <text x="56" y="132">and</text>
                  <text x="116" y="132">Provisions</text>
                  <text x="208" y="132">Credentials</text>
                  <text x="92" y="180">Resource</text>
                  <text x="96" y="196">Owner</text>
                  <text x="88" y="276">(D)</text>
                  <text x="244" y="292">Client</text>
                  <text x="316" y="292">Identifier</text>
                  <text x="184" y="308">C</text>
                  <text x="224" y="308">&amp;</text>
                  <text x="280" y="308">Redirection</text>
                  <text x="344" y="308">URI</text>
                  <text x="84" y="324">User</text>
                  <text x="472" y="324">Authorization</text>
                  <text x="88" y="340">Agent</text>
                  <text x="184" y="340">D</text>
                  <text x="236" y="340">User</text>
                  <text x="312" y="340">authenticates</text>
                  <text x="476" y="340">Server</text>
                  <text x="192" y="372">E</text>
                  <text x="280" y="372">Authorization</text>
                  <text x="356" y="372">Code</text>
                  <text x="104" y="420">(D)</text>
                  <text x="64" y="436">(C)</text>
                  <text x="64" y="452">|</text>
                  <text x="176" y="484">E</text>
                  <text x="264" y="484">Authorization</text>
                  <text x="340" y="484">Code</text>
                  <text x="92" y="500">Client</text>
                  <text x="216" y="500">&amp;</text>
                  <text x="272" y="500">Redirection</text>
                  <text x="336" y="500">URI</text>
                  <text x="176" y="532">F</text>
                  <text x="260" y="532">Access</text>
                  <text x="312" y="532">Token</text>
                  <text x="200" y="548">(w/</text>
                  <text x="252" y="548">Optional</text>
                  <text x="320" y="548">Refresh</text>
                  <text x="380" y="548">Token)</text>
                </g>
              </svg><a href="#section-3.2-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-client-registration-on-first-us" class="selfRef">Client Registration on First Use: Authorization Code Grant</a>
          </figcaption></figure>
<ul class="normal">
<li class="normal" id="section-3.2-3.1">
            <p id="section-3.2-3.1.1">(A) The OAuth authorization server establishes a trust relationship with the SPIFFE Issuer. Once trust is established, the OAuth authorization server accepts credentials issued by the SPIFFE Issuer.<a href="#section-3.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.2">
            <p id="section-3.2-3.2.1">(B) The workload is attested and credentialed by the SPIFFE Issuer <span>[<a href="#SPIFFE" class="cite xref">SPIFFE</a>]</span>. The SPIFFE Issuer assigns a SPIFFE ID <span>[<a href="#SPIFFE_ID" class="cite xref">SPIFFE_ID</a>]</span> as an identifier for the workload, along with SPIFFE credentials (e.g. JWT-SVID <span>[<a href="#SPIFFE_JWT" class="cite xref">SPIFFE_JWT</a>]</span> and X.509-SVID <span>[<a href="#SPIFFE_X509" class="cite xref">SPIFFE_X509</a>]</span>).<a href="#section-3.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.3">
            <p id="section-3.2-3.3.1">(C) The client initiates the flow by directing the resource owner's user agent to the authorization endpoint. The client includes its client identifier, requested scope, local state, and a redirection URI to which the authorization server will send the user agent back once access is granted (or denied).<a href="#section-3.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.4">
            <p id="section-3.2-3.4.1">(D) The authorization server authenticates the resource owner (via the user agent) and establishes whether the resource owner grants or denies the client's access request. If the client identifier (<code>client_id</code>) is a SPIFFE ID, it registers the SPIFFE ID as the client identifier and register additional metadata, including a redirection URI (<code>redirect_uri</code>). The additional metadata may be obtained from configuration servers or other out-of-band mechanisms that is trusted by the authorization server.<a href="#section-3.2-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.5">
            <p id="section-3.2-3.5.1">(E)  Assuming the resource owner grants access, the authorization server redirects the user agent back to the client using the redirection URI provided earlier (in the request or during client registration).  The redirection URI includes an authorization code and any local state provided by the client earlier.<a href="#section-3.2-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.6">
            <p id="section-3.2-3.6.1">(F)  The client requests an access token from the authorization server's token endpoint by including the authorization code received in the previous step.  When making the request, the client authenticates with the authorization server. It authenticates itself using either a JWT-SVID or X.509-SVID as defined in <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span>. The client includes the redirection URI used to obtain the authorization code for verification.<a href="#section-3.2-3.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-3.2-3.7">
            <p id="section-3.2-3.7.1">(G)  The authorization server authenticates the client, validates the authorization code, and ensures that the redirection URI received matches the URI used to redirect the client in step (E). If valid, the authorization server responds back with an access token and, optionally, a refresh token.<a href="#section-3.2-3.7.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="spiffe-and-oauth-trust-relationship">
<section id="section-4">
      <h2 id="name-spiffe-and-oauth-trust-rela">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-spiffe-and-oauth-trust-rela" class="section-name selfRef">SPIFFE and OAuth Trust Relationship</a>
      </h2>
<p id="section-4-1">SPIFFE makes provision for multiple Trust Domains, which are represented in the workload identifier. Trust Domains offers additional segmentation withing a SPIFFE deployment and each Trust Domain has its own keys for signing credentials. The OAuth authorization server may choose to trust one or more trust domains as defined in <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span>.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="client-authentication">
<section id="section-4.1">
        <h3 id="name-client-authentication">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-client-authentication" class="section-name selfRef">Client Authentication</a>
        </h3>
<p id="section-4.1-1">The client <span class="bcp14">SHOULD</span> authenticate itself using either a JWT-SVID or X.509-SVID as defined in <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span>.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authorization-server-processing">
<section id="section-4.2">
        <h3 id="name-authorization-server-proces">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-authorization-server-proces" class="section-name selfRef">Authorization Server Processing</a>
        </h3>
<p id="section-4.2-1">When presented with a SPIFFE ID that is used as a client identifier, the authorization server <span class="bcp14">SHOULD</span> register it as a valid client identifier. There are two cases:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="non-redirect-flows">
<section id="section-4.2.1">
          <h4 id="name-non-redirect-flows">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-non-redirect-flows" class="section-name selfRef">Non-redirect flows</a>
          </h4>
<p id="section-4.2.1-1">In non-redirect flows, the client is intereacting directly with the token endpoint. The authorization server <span class="bcp14">MUST</span> authenticate the client as described in JWT-SVID or X.509-SVID as defined in <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span>. If the JWT-SVID or X.509-SVID used to authenticate the client was issued by a trusted SPIFFE issuer, and the authentication succeeds, the SPIFFE ID <span class="bcp14">SHOULD</span> be registered as the client identifier (<code>client_id</code>).<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="redirect-flows">
<section id="section-4.2.2">
          <h4 id="name-redirect-flows">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-redirect-flows" class="section-name selfRef">Redirect flows</a>
          </h4>
<p id="section-4.2.2-1">Redirect flows typically require interaction with the Resource Owner to perform user authentication. In redirect flows, another component such as the user agent, interacts with the authorization server and relies on a redirection back to the client. Since the client does not interact directly with the authorization server in this initial interaction, it is not in a position to authenticate itself using a JWT-SVID or X.509-SVID. The user agent includes a client identifier (the SPIFFE ID) which the authorization server registers as a valid client identifier (<code>client_id</code>) after obtaining additional metadata. The metadata may be derived from the SPIFFE ID, or it may be retrieved from a configuration server. Details of obtaining the additional metadata is implementation-specific and beyond the scope of this document. If one or more redirection URIs are obtained from another source, it <span class="bcp14">MUST</span> be the same as that presented by the user agent.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2.2-2">Following the redirect back to the client, the client must authenticate to the authorization server as described in JWT-SVID or X.509-SVID as defined in <span>[<a href="#SPIFFE-OAUTH-CLIENT-AUTH" class="cite xref">SPIFFE-OAUTH-CLIENT-AUTH</a>]</span>. If the authentication fails, or the SPIFFE ID in the JWT-SVID or X.509-SVID does not match the client identifier, the request should be denied and the authorization server <span class="bcp14">MAY</span> de-register the client identifier used. If the authentication succeeds, it confirms that the client was issued a credential by a trusted SPIFFE issuer and the authorization server issues the requested tokens.<a href="#section-4.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="additional-metadata">
<section id="section-5">
      <h2 id="name-additional-metadata">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-additional-metadata" class="section-name selfRef">Additional metadata</a>
      </h2>
<p id="section-5-1">Additional metadata may be required when a client identifier (<code>client_id</code>) is first registered. The OAuth 2.0 Dynamic Client Registration Protocol <span>[<a href="#RFC7591" class="cite xref">RFC7591</a>]</span> defines client metadata that may be used. If required, client metadata <span class="bcp14">SHOULD</span> be added at the time of registration. The exact mechanisms through which this additional metadata is retrieved is out of scope of this document. Metadata may be dynamically generated or derived at the time of registration, or it may be retrieved from a system of record, such as a configuration management system in an enterprise. The SPIFFE ID presented as the client identitifier (<code>client_id</code>) may be presented to a system of record to retrieve additional metadata.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="the-redirect-uri">
<section id="section-5.1">
        <h3 id="name-the-redirect-uri">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-the-redirect-uri" class="section-name selfRef">The redirect URI</a>
        </h3>
<p id="section-5.1-1">Flows that depend on redirection requires that a redirect URI is registered along with every client identifier. Another component, like a user agent, may contact the authorization server, before being redirected to the client. In order to avoid attacks such as cross-site request forgery, open redirector attacks and similar attacck described in OAuth 2.0 Threat Model and Security Considerations <span>[<a href="#RFC6819" class="cite xref">RFC6819</a>]</span> and OAuth 2.0 Security Best Current Practice <span>[<a href="#RFC9700" class="cite xref">RFC9700</a>]</span>, the <code>redirect_uri</code> <span class="bcp14">MUST</span> be provisioned from a trustworthy source if it is required.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scopes">
<section id="section-5.2">
        <h3 id="name-scopes">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-scopes" class="section-name selfRef">Scopes</a>
        </h3>
<p id="section-5.2-1">An authorization server <span class="bcp14">MAY</span> register a client with a default set of scopes or retrieve client-specific scopes from a system of record, such as a configuration management system. Details of how to retrieve additional scope data is out of scope for this document.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="grant-types">
<section id="section-5.3">
        <h3 id="name-grant-types">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-grant-types" class="section-name selfRef">Grant Types</a>
        </h3>
<p id="section-5.3-1">Authorization servers <span class="bcp14">MAY</span> choose to limit the grant types for which the "register on first use" pattern is supported. This may be recorded as the "grant_type" metadata field.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="client-id-lifecycle-management">
<section id="section-6">
      <h2 id="name-client-id-lifecycle-managem">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-client-id-lifecycle-managem" class="section-name selfRef">Client ID Lifecycle Management</a>
      </h2>
<p id="section-6-1">The number of client ids registered with an authorization server may grow significantly over time. An authorization <span class="bcp14">MAY</span> unregistered a client id if it has not been used for an extended period of time to reduce the size of the client registration database.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">TODO Security<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document has no IANA actions.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="Headless_JWT">[Headless_JWT]</dt>
        <dd>
<span class="refTitle">"Headless-JWT"</span>, <span>n.d.</span>, <span>&lt;<a href="foo">foo</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6749">[RFC6749]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6749">https://www.rfc-editor.org/rfc/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6755">[RFC6755]</dt>
        <dd>
<span class="refAuthor">Campbell, B.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"An IETF URN Sub-Namespace for OAuth"</span>, <span class="seriesInfo">RFC 6755</span>, <span class="seriesInfo">DOI 10.17487/RFC6755</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6755">https://www.rfc-editor.org/rfc/rfc6755</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7517">[RFC7517]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"JSON Web Key (JWK)"</span>, <span class="seriesInfo">RFC 7517</span>, <span class="seriesInfo">DOI 10.17487/RFC7517</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7517">https://www.rfc-editor.org/rfc/rfc7517</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7521">[RFC7521]</dt>
        <dd>
<span class="refAuthor">Campbell, B.</span>, <span class="refAuthor">Mortimore, C.</span>, <span class="refAuthor">Jones, M.</span>, and <span class="refAuthor">Y. Goland</span>, <span class="refTitle">"Assertion Framework for OAuth 2.0 Client Authentication and Authorization Grants"</span>, <span class="seriesInfo">RFC 7521</span>, <span class="seriesInfo">DOI 10.17487/RFC7521</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7521">https://www.rfc-editor.org/rfc/rfc7521</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7523">[RFC7523]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Campbell, B.</span>, and <span class="refAuthor">C. Mortimore</span>, <span class="refTitle">"JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication and Authorization Grants"</span>, <span class="seriesInfo">RFC 7523</span>, <span class="seriesInfo">DOI 10.17487/RFC7523</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7523">https://www.rfc-editor.org/rfc/rfc7523</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8705">[RFC8705]</dt>
        <dd>
<span class="refAuthor">Campbell, B.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Sakimura, N.</span>, and <span class="refAuthor">T. Lodderstedt</span>, <span class="refTitle">"OAuth 2.0 Mutual-TLS Client Authentication and Certificate-Bound Access Tokens"</span>, <span class="seriesInfo">RFC 8705</span>, <span class="seriesInfo">DOI 10.17487/RFC8705</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8705">https://www.rfc-editor.org/rfc/rfc8705</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPIFFE">[SPIFFE]</dt>
        <dd>
<span class="refTitle">"SPIFFE"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE.md">https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE.md</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPIFFE-OAUTH-CLIENT-AUTH">[SPIFFE-OAUTH-CLIENT-AUTH]</dt>
        <dd>
<span class="refTitle">"OAuth SPIFFE Client Authentication"</span>, <span>n.d.</span>, <span>&lt;<a href="foo">foo</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPIFFE_BUNDLE">[SPIFFE_BUNDLE]</dt>
        <dd>
<span class="refTitle">"SPIFFE Bundle"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE_Trust_Domain_and_Bundle.md#4-spiffe-bundle-format">https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE_Trust_Domain_and_Bundle.md#4-spiffe-bundle-format</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPIFFE_FEDERATION">[SPIFFE_FEDERATION]</dt>
        <dd>
<span class="refTitle">"SPIFFE Federation"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE_Federation.md">https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE_Federation.md</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPIFFE_ID">[SPIFFE_ID]</dt>
        <dd>
<span class="refTitle">"SPIFFE-ID"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE-ID.md">https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE-ID.md</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPIFFE_JWT">[SPIFFE_JWT]</dt>
        <dd>
<span class="refTitle">"JWT-SVID"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/spiffe/spiffe/blob/main/standards/JWT-SVID.md">https://github.com/spiffe/spiffe/blob/main/standards/JWT-SVID.md</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPIFFE_X509">[SPIFFE_X509]</dt>
      <dd>
<span class="refTitle">"X509-SVID"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/spiffe/spiffe/blob/main/standards/X509-SVID.md">https://github.com/spiffe/spiffe/blob/main/standards/X509-SVID.md</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC6819">[RFC6819]</dt>
        <dd>
<span class="refAuthor">Lodderstedt, T., Ed.</span>, <span class="refAuthor">McGloin, M.</span>, and <span class="refAuthor">P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Threat Model and Security Considerations"</span>, <span class="seriesInfo">RFC 6819</span>, <span class="seriesInfo">DOI 10.17487/RFC6819</span>, <time datetime="2013-01" class="refDate">January 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6819">https://www.rfc-editor.org/rfc/rfc6819</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7591">[RFC7591]</dt>
        <dd>
<span class="refAuthor">Richer, J., Ed.</span>, <span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Machulak, M.</span>, and <span class="refAuthor">P. Hunt</span>, <span class="refTitle">"OAuth 2.0 Dynamic Client Registration Protocol"</span>, <span class="seriesInfo">RFC 7591</span>, <span class="seriesInfo">DOI 10.17487/RFC7591</span>, <time datetime="2015-07" class="refDate">July 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7591">https://www.rfc-editor.org/rfc/rfc7591</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9700">[RFC9700]</dt>
      <dd>
<span class="refAuthor">Lodderstedt, T.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Labunets, A.</span>, and <span class="refAuthor">D. Fett</span>, <span class="refTitle">"Best Current Practice for OAuth 2.0 Security"</span>, <span class="seriesInfo">BCP 240</span>, <span class="seriesInfo">RFC 9700</span>, <span class="seriesInfo">DOI 10.17487/RFC9700</span>, <time datetime="2025-01" class="refDate">January 2025</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9700">https://www.rfc-editor.org/rfc/rfc9700</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">TODO acknowledge.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Pieter Kasselman</span></div>
<div dir="auto" class="left"><span class="org">SPIRL</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:pieter@spirl.com" class="email">pieter@spirl.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
